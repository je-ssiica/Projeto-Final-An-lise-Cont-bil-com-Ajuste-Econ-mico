# -*- coding: utf-8 -*-
"""ListaExercicio4.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1r-JyqNpaGTmSyKjl7p-435i8dNA-u0B8

# ðŸ“Š Projeto Final â€“ AnÃ¡lise ContÃ¡bil com Ajuste EconÃ´mico

Este projeto tem como objetivo integrar anÃ¡lise de dados contÃ¡beis de empresas com indicadores econÃ´micos, utilizando Python, Pandas, Ipeadata e Streamlit.

1) Configure o tÃ­tulo na barra do navegador, da pÃ¡gina do projeto no Streamlit e descriÃ§Ã£o inicial do projeto (peso: 1,0)

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt 

- TÃ­tulo na barra (`page_title`): Lista de ExercÃ­cios 4
- TÃ­tulo da pÃ¡gina (`header`): Projeto Final â€“ AnÃ¡lise ContÃ¡bil com Ajuste EconÃ´mico
- DescriÃ§Ã£o projeto (`write`): Este projeto tem como objetivo integrar anÃ¡lise de dados contÃ¡beis de empresas com indicadores econÃ´micos, utilizando Python, Pandas, Ipeadata e Streamlit.
"""




import streamlit as st

import pandas as pd
DataFrame = pd.DataFrame

st.set_page_title = "Lista de ExercÃ­cios 4"
st.write(st.set_page_title)

st.header = "Projeto Final â€“ AnÃ¡lise ContÃ¡bil com Ajuste EconÃ´mico"
st.write(st.header)

st = ("Este projeto tem como objetivo integrar anÃ¡lise de dados contÃ¡beis de empresas com indicadores econÃ´micos, utilizando Python, Pandas, Ipeadata e Streamlit.")

"""2) Importe os dados do arquivo empresas_dados.csv utilizando pandas e apresente todas as linhas da df (peso: 1,0)

Dica: Utilize `head(len(df))`
"""

import pandas as pd
df = pd.read_csv('empresas_dados.csv', sep=";")
st.dataframe(df.head(len(df)))


"""3) Calcule os indicadores Margem LÃ­quida e ROA e salve como novas coluna da df. Depois apresente os dois indicadores no mesmo grÃ¡fico de linhas, agrupado por Ano  (peso: 1,0)

- Margem LÃ­quida = Lucro LÃ­quido / Receita LÃ­quida * 100
- ROA = Lucro LÃ­quido / Ativo Total *  100
"""

import matplotlib.pyplot as plt

df['Margem LÃ­quida'] = (df['Lucro LÃ­quido'] / df['Receita LÃ­quida']) * 100
df['ROA'] = (df['Lucro LÃ­quido'] / df['Ativo Total']) * 100

fig, ax = plt.subplots()

st_grouped = df.groupby('Ano')[['Margem LÃ­quida', 'ROA']].mean().reset_index()

fig, ax = plt.subplots(figsize=(10, 6))
ax.plot(st_grouped['Ano'], st_grouped['Margem LÃ­quida'], marker='o', label='Margem LÃ­quida (%)')
ax.plot(st_grouped['Ano'], st_grouped['ROA'], marker='o', label='ROA (%)')

ax.set_title('Indicadores Financeiros ao Longo dos Anos')
ax.set_xlabel('Ano')
ax.set_ylabel('Percentual (%)')
ax.legend()
ax.grid(True)
plt.show()
st.pyplot(fig)


"""4) Utilize o pacote ipeadatapy e faÃ§a busca para encontrar o indicador que traga o IPCA, taxa de variaÃ§Ã£o, em % e anual: (peso: 2,0)

- Baixe os dados no perÃ­odo de 2010 a 2024
- Altere o nome da coluna "YEAR" para "Ano"
- Altere o nome da coluna "VALUE ((% a.a.))" para "IPCA"
- Apresente a df para checar se tudo deu certo
"""


import ipeadatapy as ip

import pandas as pd

df_ipca = ip.timeseries('PRECOS12_IPCA12')

df_ipca = df_ipca[(df_ipca['YEAR'] >= 2010) & (df_ipca['YEAR'] <= 2024)]

st.write("Colunas antes da alteraÃ§Ã£o:")
print(df_ipca.columns)

df_ipca = df_ipca.rename(columns={
    'YEAR': 'Ano',
    'VALUE (-)': 'IPCA'
})

st.write("\nColunas apÃ³s a alteraÃ§Ã£o:")
print(df_ipca.columns)

st.write("\nDataFrame resultado:")
st_ipca

"""5) Combine as duas df (Excel e IPEA) em uma nova df e calcule nova coluna chamada Receita Real (peso: 2,0)

- Utilize a funÃ§Ã£o `pd.merge()` para unificar as duas df utiilizando a coluna Ano como conexÃ£o (chave primÃ¡ria) entre elas
- Crie nova coluna chamada Receita Real que serÃ¡ o resultado da Receita LÃ­quida de cada ano deduzido o IPCA do ano: `Receita Real = Receitta LÃ­quida - ( Receita LÃ­quida * (IPCA/100) )`
- Apresente a nova df combinada

"""

st_excel = pd.DataFrame({
    'Ano': [2020, 2021, 2022],
    'Receita LÃ­quida': [1000, 1200, 1400]
})

st_ipea = pd.DataFrame({
    'Ano': [2020, 2021, 2022],
    'IPCA': [3.5, 4.0, 5.0]
})

st_combined = pd.merge(df_excel, df_ipea, on='Ano')
st_combined['Receita Real'] = df_combined['Receita LÃ­quida'] * (1 - df_combined['IPCA'] / 100)

st_combined

"""6) Crie grÃ¡fico de linha que apresente as variÃ¡veis Receita LÃ­quida e Receita Real ao longo dos anos (no mesmo grÃ¡fico) (peso: 1,0)"""

import pandas as pd
import matplotlib.pyplot as plt

st_combined = pd.DataFrame({
    'Ano': [2021, 2022, 2023],
    'Receita LÃ­quida': [1000, 1200, 1400],
    'Receita Real': [965, 1152, 1330]
})

fig, ax = plt.subplots()
ax.set.figure(figsize=(10,6))
ax.set.plot(df_combined['Ano'], df_combined['Receita LÃ­quida'], marker='o', label='Receita LÃ­quida')
ax.set.plot(df_combined['Ano'], df_combined['Receita Real'], marker='s', label='Receita Real')
ax.set.title('Receita LÃ­quida e Receita Real ao longo dos anos')
ax.set.xlabel('Ano')
ax.set.ylabel('Valor')
ax.set.legend()
ax.set.grid(True)
ax.set.show()
st.pyplot(fig)

"""7) FaÃ§a os ajustes necessÃ¡rios e leve este projeto para a web usando GitHub e Streamlit (peso: 2,0)

- CaÃ§a os ajustes necessÃ¡rios no projeto para ser publicado no Streamlit
- Crie novo repositÃ³rio pÃºblico no GitHub e leve os arquivos .py e .csv pra lÃ¡. Aproveite e crie o arquivo requirements.txt com os pacotes utilizados no projeto
- Crie novo projeto no Streamlit e associe ao repositÃ³rio da lista
"""
